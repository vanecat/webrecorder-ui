<div id="app">
  <div class="short-nav">
    <div class="first-line">
      <div class="logo"><img src="/static/webarch-logo.png" /></div>
      <div class="url-and-timeline">
        <div class="url">
          <select v-model="url" @change="loadUrl">
            <option>url</option>
            <option v-for="sample in sampleData" :value="sample">{{sample}}</option>
          </select>
        </div>
        <timeline
                v-if="currentPeriod"
                :period="currentPeriod"
                @goto-period="gotoPeriod"
        ></timeline>
      </div>
    </div>
    <div class="second-line">
      <timeline-summary
              v-if="currentPeriod"
              :period="currentPeriod"
              @goto-period="gotoPeriod"
      ></timeline-summary>
      <span class="full-view-toggle" :class="{expanded: showFullView}" @click="showFullView = !showFullView">
                <template v-if="!showFullView"><span class="detail">show year calendar</span></template><template v-else><span class="detail">hide year calendar</span></template>
            </span>
    </div>
  </div>

  <calendar-year v-if="showFullView"
                 :period="currentPeriod"
                 @goto-period="gotoPeriod">
  </calendar-year>
  <div class="iframe" v-if="currentSnapshot">
    <iframe :src="currentSnapshot.load_url"></iframe>
  </div>
</div>
<script>
  Pywb.vue.app = {
    el: '#app',
    data: {
      url: '',
      snapshots: [],
      currentPeriod: null,
      currentSnapshot: null,
      msgs: [],
      sampleData: ['bbc-com', 'uk-gov'],
      showFullView: false
    },
    mounted: function() {
      // DEVELOPMENT ONLY (TODO: remove when deploying app)
      // make initial sample data appear on "mounted" (faster for development)
      this.url = this.sampleData[0];
      this.loadUrl();
    },
    methods: {
      loadUrl() {
        // https://www.webarchive.org.uk/wayback/en/archive/cdx?
        const url = `/sample-data/${this.url}.json?output=json&url=${encodeURIComponent(this.url)}`;
        fetch(url, {mode: 'cors'}).then(r => r.json()).then(data => this.initData(data));
      },
      initData(data_) {
        try {
          const data = new PywbData(data_);
          this.snapshots = data.snapshots;
          this.currentPeriod = data.timeline;
        } catch(e) {
          console.error(e.message);
        }
      },
      gotoPeriod: function(newPeriod) {
        if (newPeriod.snapshot) {
          // if single-snapshot period, just go to snapshot (do not change timeline period)
          this.currentSnapshot = newPeriod.snapshot;
        } else {
          this.currentPeriod = newPeriod;
        }
      }
    }
  };
  Pywb.init();
</script>

<style>
  #app {
    border-bottom: 1px solid lightcoral;
    height: 150px;
    width: 100%;
  }
  .iframe iframe {
    width: 100%;
    height: 80vh;
  }
  .logo {
    margin-right: 30px;
    width: 180px;
  }
  .short-nav {
    width: 100%;
    position: relative;
  }
  .short-nav .first-line {
    display: flex;
    justify-content: flex-start;
  }
  .short-nav .second-line {
    display: flex;
    justify-content: flex-start;
  }

  .short-nav .logo {
    flex-shrink: initial;
  }

  .short-nav .url-and-timeline {
    flex-grow: 2;
    overflow-x: hidden;
  }

  .short-nav .url {
    text-align: left;
    margin: 0 25px;
  }
  .short-nav .url .go-btn {
    position: relative;
    left: 0;
    display: inline-block;
    height: 15px;
    line-height: 15px;
    padding: 2px;
    border: 1px solid black;
    border-radius: 5px;
    background-color: #eeeeee;
    cursor: pointer;
    transition: left 300ms ease-in, background-color 300ms ease-in;
  }
  .short-nav .url .go-btn:hover {
    background-color: antiquewhite;
    left: 3px;
  }
  .short-nav .url input, .short-nav .url select {
    width: 50%;
  }

  .full-view-toggle {
    margin-left: 10px;
    padding-left: 30px;
    background-image: url(/static/calendar-icon.png);
    background-repeat: no-repeat;
    background-position: 0 2px;
    background-size: 30px;
    line-height: 30px;
    border-radius: 5px;
    cursor: zoom-in;
  }
  .full-view-toggle:hover {
    background-color: #eeeeee;
  }
  .full-view-toggle .detail {
    display: none;
  }
  .full-view-toggle:hover .detail {
    display: inline;
  }
  .full-view-toggle.expanded {
    background-color: #eeeeee;
    cursor: zoom-out;
  }
</style>