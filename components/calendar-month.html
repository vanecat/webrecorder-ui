<style>
    .calendar-month {
        display: inline-block;
        padding: 5px;
        margin: 15px;
        /*height: 120px;*/
        vertical-align: top;
        border: 1px;
    }
    .calendar-month .day {
        position: relative;
        display: inline-block;
        margin: 0;
        text-align: center;
        z-index: 20;
    }
    .calendar-month .day.empty {
        color: gray;
    }
    .calendar-month .day .count {
        display: none;
        position: absolute;
        top: -20%;
        right: -20%;
        padding: 1px;
        border-radius: 2px;
        background-color: white;
        z-index: 30;
    }
    .calendar-month .day:hover .count {
        display: block;
    }
    .calendar-month .day .size {
        position: absolute;
        background-color: rgba(200,100,100,.5);
        z-index: 10;
    }
</style>

<script type="text/x-template" id="calendar-month">
    <div class="calendar-month">
        {{month.parent.id}}/{{month.id}}:<br/>
        <span v-for="(day) in ['S', 'M', 'T', 'W', 'H', 'F', 'S']" class="day" :style="dayStyle">{{day}}</span><br/>
        <span v-for="(day,i) in days"><br v-if="i && i % 7===0"/><span class="day" :class="{empty: !day || !day.snapshotCount}" :style="dayStyle"><template v-if="day"><span class="size" :style="getDayCountCircleStyle(day.snapshotCount)"></span>{{day.id}}<span class="count" v-if="day.snapshotCount">{{day.snapshotCount}}</span></template><template v-else>&nbsp;</template></span></span>
    </div>
</script>

<script type="text/javascript">
    Pywb.vue.components['calendar-month'] = {
        template: '#calendar-month',
        props: ['month'],
        data: function() {
            return {
                days: [],
                maxInDay: 0,
                daySize: 30,
            };
        },
        computed: {
            dayStyle() {
                const s = this.daySize;
                return `height: ${s}px; width: ${s}px; line-height: ${s}px`;
            }
        },
        mounted() {
            // Get days in month, and days in the complete weeks before first day and after last day
            const [firstDay, lastDay] = this.month.getChildrenRange();
            const daysBeforeFirst = (new Date(this.month.parent.id, this.month.id-1, firstDay)).getDay();
            const daysAfterLastDay = (6 - (new Date(this.month.parent.id, this.month.id-1, lastDay)).getDay());
            for(let i=0; i<daysBeforeFirst; i++) {
                this.days.push(null);
            }
            const hasChildren = !!this.month.children.length;
            for(let i=0; i<lastDay; i++) {
                this.days.push(hasChildren ? this.month.children[i] : null);
            }
            for(let i=0; i<daysAfterLastDay; i++) {
                this.days.push(null);
            }

            // Get max snapshos in a day in entire year
        },
        methods: {
            getDayCountCircleStyle(snapshotCount) {
                const size = Math.ceil((snapshotCount/this.month.parent.maxGrandchildSnapshotCount) * this.daySize);
                const scaledSize = size ? (this.daySize*.3 + Math.ceil(size*.7)) : 0;
                const margin = (this.daySize-scaledSize)/2;

                // color hue should go form blue (240deg) to red (360deg)
                const colorHue = Math.ceil((snapshotCount/this.month.parent.maxGrandchildSnapshotCount) * (360-240));
                const scaledColorHue = size ? (240 + colorHue) : 240;

                return `width: ${scaledSize}px; height: ${scaledSize}px; top: ${margin}px; left: ${margin}px; border-radius: ${scaledSize/2}px; background-color: hsl(${scaledColorHue}, 100%, 50%, .2)`;
            }
        }
    };
</script>

